#!/bin/bash

# JZJN CMS Launcher
DIR="$(dirname "$0")/../../.."
CMS_DIR="$DIR/cms"

cd "$CMS_DIR"

# Add common Node.js paths
export PATH="/usr/local/bin:/opt/homebrew/bin:$PATH"

# Check for node
if ! command -v node &> /dev/null; then
    osascript -e 'display alert "Node.js Required" message "Please install Node.js from https://nodejs.org"'
    exit 1
fi

# Install dependencies if needed
if [ ! -d "node_modules" ]; then
    osascript -e 'display notification "Installing dependencies..." with title "JZJN CMS"'
    npm install
fi

# Check if already running
if lsof -i :3000 &> /dev/null; then
    open "http://localhost:3000/admin/"
    exit 0
fi

# Start server and open browser
osascript -e 'display notification "Starting CMS server..." with title "JZJN CMS"'
node server.js &
SERVER_PID=$!

# Wait for server to start
sleep 2

# Open browser
open "http://localhost:3000/admin/"

# Keep running until server stops
wait $SERVER_PID
